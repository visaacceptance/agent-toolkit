<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visa Payment Demo - Unified Checkout</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #1a1f71; /* Visa blue */
        }
        .container {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
        }
        pre {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .button {
            background-color: #1a1f71;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }
        .button:hover {
            background-color: #142057;
        }
        .info {
            background-color: #f8f9fa;
            padding: 15px;
            border-left: 4px solid #1a1f71;
            margin: 20px 0;
        }
        #payment-container {
            min-height: 200px;
            margin-top: 20px;
        }
        #status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <h1>Visa Payment Demo - Unified Checkout</h1>
    
    <div class="info">
        <p>This demo shows how to use CyberSource's Unified Checkout with a capture context for Visa cards in USD currency.</p>
        <p>The capture context was generated using the CyberSource MCP server.</p>
    </div>
    
    <div class="container">
        <h2>Capture Context Details</h2>
        <div id="capture-context-details"></div>
        
        <button id="initialize-button" class="button">Initialize Payment Form</button>
        
        <div id="payment-container"></div>
        <div id="status"></div>
    </div>

    <script>
        // The capture context generated by the MCP server
        const captureContext = "eyJraWQiOiJ6dSIsImFsZyI6IlJTMjU2In0.eyJmbHgiOnsicGF0aCI6Ii9mbGV4L3YyL3Rva2VucyIsImRhdGEiOiJyTGxNcGNiODJCa1JkWnhTMUhITFVoQUFFQzQ1MU8rTWgxMEtEaVpBMzdKdmhQdG95ZW9vNVBrbDBUTmZIc1IvREJqWWZ0OWx2Z1c3TFBENGdPdzBoNmpWa09XV0dzd1BqNWtGQ0ZQMGNYaGZPd1VBbWg3VGxyZEJjMFZjZzRiazZSSysiLCJvcmlnaW4iOiJodHRwczovL3Rlc3RmbGV4LmN5YmVyc291cmNlLmNvbSIsImp3ayI6eyJrdHkiOiJSU0EiLCJlIjoiQVFBQiIsInVzZSI6ImVuYyIsIm4iOiIyR0U5dDlFTWRLRV92LXR3TFJYRW5nVnFXelNmV0FpazVSaDVkekFwWkR4RzlETTJ4dWZJVWFiQjZ4YUZXY0ZwdDJma1JqZnd0RVJOZllLbjBXeGZPSENudHUxaHNwcV91WGgwUU1UVmE5WHZYek96bi1yR1VRVjVUbVVRdUZVRVVydjZycWFFZHhhb2FaMmY5b1RFVHJmaGczSzBTOXk0aXlrb2tkNmJFNkNMc0w0V2FySVhBNXF6NWx5c1NwMmhtWXN4aC1QV3RrY0FqODdhU2J3VUpreDBGTjY2Z0JNdTBsNHhvZGlxVlg3SW1FcmZNay1uT1JXTUJKaTNkVjd4TlZMcjZJcXFZOUNjNFp2eUJtaV9IeFZka0c4dEIyVzdWTlZyQnlQOTVKbEJGNkdSaGwxUEhoVXFVSVJBNm0xT1VQcDhWanV3QlFKUXZDTlFxOEVCY1EiLCJraWQiOiIwOG5kVWpQakwxSHV2bDZSZ0NmSDgwQlZ6RDhES0x1aiJ9fSwiY3R4IjpbeyJkYXRhIjp7ImFsbG93ZWRQYXltZW50VHlwZXMiOlsiQ0xJQ0tUT1BBWSIsIlBBTkVOVFJZIiwiR09PR0xFUEFZIl0sInBheW1lbnRDb25maWd1cmF0aW9ucyI6eyJTUkNWSVNBIjp7Im9yaWdpbiI6Imh0dHBzOi8vc2FuZGJveC1hc3NldHMuc2VjdXJlLmNoZWNrb3V0LnZpc2EuY29tIiwicGF0aCI6Ii9jaGVja291dC13aWRnZXQvcmVzb3VyY2VzL2pzL3NyYy1pLWFkYXB0ZXIvdmlzYVNkay5qcz92MiIsInBhbkVuY3J5cHRpb25LZXkiOnsia3R5IjoiUlNBIiwiZSI6IkFRQUIiLCJ1c2UiOiJlbmMiLCJraWQiOiJXMFBaOFZYVVZFQlU5NUpPNlpEWTEzc3E1Si1keFRuNTZmSWJEWDZObWMzWmo5V3FjIiwibiI6InNaUEl1c0RmN3lRbm5oQmtVOW11MTRWT08zQ3J1aTNiN3JBZjJLWWVvYlVSbVhBMTdiMUpYOWpnMENkLXZncG11eVRyeEJVU2MtNGIwLVVQZ1N3R0ZxUFdVcHgwOEV4cXJ3UERPdkZvakJvdTJ3bHlxOGJjeTBVcy1CZmVDelNFNWxNVmRTWFRYWFhjTnF1LXFiMjJqQ0NDSkFMcHhzQXJzYm9NT1hzTGVkaDNNNFhOUTVYR0F0UmY3Yi0tdVRZNURyOUtMWXlVdlpLQW5ZMDRNS0pQRU81NFlpSUZNNURUQWhOT21zMDg5amRNZHgtVVJJS0pqUFUyLVJwSEcxdThMQ0cwMjhSVElwUHNOYlJhbnVTNVRBWV96bHhEZ2IxaEtKMzZZYlpFTkhMZzlQWFRCaGRPTWxVOTBEVExsZmNiTFRhLUQ3RGdsakFhV0N1dnpMUGFHdyJ9LCJwYXJhbWV0ZXJzIjp7InNyY0luaXRpYXRvcklkIjoiSkZDWjhRVk9KQTc2TlhaNjhGWkQyMVJZSXhqM3lQWmRpVXhrZE51aWJCbHhnd2FQNCIsInNyY2lEcGFJZCI6ImQzM2NmZjc4LWI2M2EtNGZlNy1iZWJhLTczYmE1YzY1M2ZiZiIsInNyY2lUcmFuc2FjdGlvbklkIjoiODUzMzNkZDUtZGNmMy00NjE2LWIwYmUtZTBkNGYzYjQwMzhlIiwiZHBhVHJhbnNhY3Rpb25PcHRpb25zIjp7ImRwYUxvY2FsZSI6ImVuX1VTIiwicGF5bG9hZFR5cGVJbmRpY2F0b3IiOiJGVUxMIiwicmV2aWV3QWN0aW9uIjoiY29udGludWUiLCJkcGFBY2NlcHRlZEJpbGxpbmdDb3VudHJpZXMiOltdLCJkcGFBY2NlcHRlZFNoaXBwaW5nQ291bnRyaWVzIjpbIlVTIiwiR0IiXSwiZHBhQmlsbGluZ1ByZWZlcmVuY2UiOiJBTEwiLCJkcGFTaGlwcGluZ1ByZWZlcmVuY2UiOiJBTEwiLCJjb25zdW1lck5hbWVSZXF1ZXN0ZWQiOnRydWUsImNvbnN1bWVyRW1haWxBZGRyZXNzUmVxdWVzdGVkIjp0cnVlLCJjb25zdW1lclBob25lTnVtYmVyUmVxdWVzdGVkIjp0cnVlLCJtZXJjaGFudENvdW50cnlDb2RlIjoiVVMiLCJjdXN0b21JbnB1dERhdGEiOnsiY2hlY2tvdXRPcmNoZXN0cmF0b3IiOiJtZXJjaGFudCJ9LCJ0cmFuc2FjdGlvbkFtb3VudCI6eyJ0cmFuc2FjdGlvbkFtb3VudCI6IjIxLjAwIiwidHJhbnNhY3Rpb25DdXJyZW5jeUNvZGUiOiJVU0QifSwicGF5bWVudE9wdGlvbnMiOnsiZHBhUGFuUmVxdWVzdGVkIjp0cnVlfX19fSwiR09PR0xFUEFZIjp7ImNsaWVudExpYnJhcnkiOiJodHRwczovL3BheS5nb29nbGUuY29tL2dwL3AvanMvcGF5LmpzIiwicGF5bWVudE9wdGlvbnMiOnsiZW52aXJvbm1lbnQiOiJURVNUIn0sInBheW1lbnREYXRhUmVxdWVzdCI6eyJhcGlWZXJzaW9uIjoyLCJhcGlWZXJzaW9uTWlub3IiOjAsIm1lcmNoYW50SW5mbyI6eyJtZXJjaGFudElkIjoiQkNSMkRONFQ3RERZQlRUViIsIm1lcmNoYW50TmFtZSI6IlZpc2EgQWNjZXB0YW5jZSBTb2x1dGlvbnMifSwiYWxsb3dlZFBheW1lbnRNZXRob2RzIjpbeyJ0eXBlIjoiQ0FSRCIsInBhcmFtZXRlcnMiOnsiYWxsb3dlZEF1dGhNZXRob2RzIjpbIlBBTl9PTkxZIiwiQ1JZUFRPR1JBTV8zRFMiXSwiYWxsb3dlZENhcmROZXR3b3JrcyI6WyJWSVNBIl0sImJpbGxpbmdBZGRyZXNzUmVxdWlyZWQiOnRydWUsImJpbGxpbmdBZGRyZXNzUGFyYW1ldGVycyI6eyJmb3JtYXQiOiJGVUxMIiwicGhvbmVOdW1iZXJSZXF1aXJlZCI6dHJ1ZX19LCJ0b2tlbml6YXRpb25TcGVjaWZpY2F0aW9uIjp7InR5cGUiOiJQQVlNRU5UX0dBVEVXQVkiLCJwYXJhbWV0ZXJzIjp7ImdhdGV3YXkiOiJjeWJlcnNvdXJjZSIsImdhdGV3YXlNZXJjaGFudElkIjoidmlzYV9pc3Zfd29vX3BtdDAwMSJ9fX1dLCJ0cmFuc2FjdGlvbkluZm8iOnsidG90YWxQcmljZVN0YXR1cyI6IkZJTkFMIiwidG90YWxQcmljZSI6IjIxLjAwIiwiY291bnRyeUNvZGUiOiJVUyIsImN1cnJlbmN5Q29kZSI6IlVTRCJ9LCJlbWFpbFJlcXVpcmVkIjp0cnVlLCJzaGlwcGluZ0FkZHJlc3NSZXF1aXJlZCI6dHJ1ZSwic2hpcHBpbmdBZGRyZXNzUGFyYW1ldGVycyI6eyJhbGxvd2VkQ291bnRyeUNvZGVzIjpbIlVTIiwiR0IiXSwicGhvbmVOdW1iZXJSZXF1aXJlZCI6dHJ1ZX19fX0sImNhcHR1cmVNYW5kYXRlIjp7ImJpbGxpbmdUeXBlIjoiRlVMTCIsInJlcXVlc3RFbWFpbCI6dHJ1ZSwicmVxdWVzdFBob25lIjp0cnVlLCJyZXF1ZXN0U2hpcHBpbmciOnRydWUsInNoaXBUb0NvdW50cmllcyI6WyJVUyIsIkdCIl0sInNob3dBY2NlcHRlZE5ldHdvcmtJY29ucyI6dHJ1ZX0sIm9yZGVySW5mb3JtYXRpb24iOnsiYW1vdW50RGV0YWlscyI6eyJ0b3RhbEFtb3VudCI6IjIxLjAwIiwiY3VycmVuY3kiOiJVU0QifX0sInRhcmdldE9yaWdpbnMiOlsiaHR0cHM6Ly91bmlmaWVkLXBheW1lbnRzLmFwcHNwb3QuY29tIl0sImlmcmFtZXMiOnsibWNlIjoiL21jZS9tY2UuaHRtbCIsImJ1dHRvbnMiOiIvYnV0dG9ubGlzdC9idXR0b25saXN0Lmh0bWwiLCJzcmMiOiIvc2VjdXJlLXJlbW90ZS1jb21tZXJjZS9zcmMuaHRtbCIsImN0cCI6Ii9jdHAvY3RwLmh0bWwiLCJnb29nbGVwYXkiOiIvZ29vZ2xlcGF5L2dvb2dsZXBheS5odG1sIiwiYXBwbGVwYXkiOiIvYXBwbGVwYXkvYXBwbGVwYXkuaHRtbCIsInBhemUiOiIvcGF6ZS9wYXplLmh0bWwiLCJjaGVjayI6Ii9jaGVjay9jaGVjay5odG1sIn0sImNsaWVudFZlcnNpb24iOiIwLjIzIiwiY291bnRyeSI6IlVTIiwibG9jYWxlIjoiZW5fVVMiLCJhbGxvd2VkQ2FyZE5ldHdvcmtzIjpbIlZJU0EiXSwiY3IiOiJGWWp4a1FpOXZNSUp6TVhjZzRHTlFieXFEZGZaQUhuSUh1TTByaTRxUnlROGxyaDlfeC1oUWdVUEdQYWJsS0lkd1NlWWs5dVFEalN5N1ZBYkw1WmxFN3VaV21sd19qNzVGMDZKeUZkTXM2OHN1V1BGdExFcHppbGFrVGk3OWVHQlk1SUVEazlJZ09UX09lM2ZpV1g5ZEdFV1U0dyIsInNlcnZpY2VPcmlnaW4iOiJodHRwczovL2FwaXRlc3QuY3liZXJzb3VyY2UuY29tIiwiY2xpZW50TGlicmFyeSI6Imh0dHBzOi8vYXBpdGVzdC5jeWJlcnNvdXJjZS5jb20vdWMvdjEvYXNzZXRzLzAuMjMuMS9TZWN1cmVBY2NlcHRhbmNlLmpzIiwibG9nZ2luZ1BhdGgiOiIvdWMvdjEvbG9nLWV2ZW50cyIsImFzc2V0c1BhdGgiOiIvdWMvdjEvYXNzZXRzLzAuMjMuMSIsImNsaWVudExpYnJhcnlJbnRlZ3JpdHkiOiJzaGEyNTYtMDhhZlRWcmF1SmRpMVgvc3VLRTZSYTVDdXhCWkZSM29wTmxXSTVaak1NMFx1MDAzZCJ9LCJ0eXBlIjoiZ2RhLTAuMTAuMCJ9XSwiaXNzIjoiRmxleCBBUEkiLCJleHAiOjE3NDIzODk2NjksImlhdCI6MTc0MjM4ODc2OSwianRpIjoiQmF3bUZkRkdSYnF1dVh0biJ9.SLOphUb-2yePKkzB3dq4TINiURk_FAOsSuFIXLJeMcZRGsBeypKtiwC1oeKgqFqNtnGfP5NugNKPRt6rSD8-_PyGX7fxYdHXsDagie-kP_6P7rh2YHxhtAirDZd1TDOzWrkH7teMU8xuko1UPqioPd9-EuSgXgs9YCWiCzCYWX86nvSEaOwjDXYQ4o2yBGGzcyu9pLWTG56UIS2CNA4L8EC2NKjBwr04ng0rKpr4pnSDthD8sE2ZFMZiYpWP8wMGBlSwr9HiZJ4I1vxZ9R3tR6L9ydp7fSWilgyk9Rs_dJGq9RjOgpfl9zVHRtN4cHFelSka1UODAGlAI6ArhLVIoQ";

        // Function to parse JWT and extract payload
        function parseJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));

            return JSON.parse(jsonPayload);
        }

        // Function to display capture context details
        function displayCaptureContextDetails() {
            try {
                const payload = parseJwt(captureContext);
                
                // Extract clientLibrary and clientLibraryIntegrity
                const clientLibrary = payload.ctx[0].data.clientLibrary;
                const clientLibraryIntegrity = payload.ctx[0].data.clientLibraryIntegrity;
                
                // Display details
                const detailsContainer = document.getElementById('capture-context-details');
                detailsContainer.innerHTML = `
                    <pre>
<strong>Client Library:</strong> ${clientLibrary || 'Not found in JWT'}
<strong>Client Library Integrity:</strong> ${clientLibraryIntegrity || 'Not found in JWT'}
<strong>Allowed Card Networks:</strong> ${payload.ctx[0].data.allowedCardNetworks.join(', ')}
<strong>Currency:</strong> ${payload.ctx[0].data.orderInformation?.amountDetails?.currency || 'Not specified'}
<strong>Amount:</strong> ${payload.ctx[0].data.orderInformation?.amountDetails?.totalAmount || 'Not specified'}
                    </pre>
                `;
            } catch (error) {
                console.error('Error parsing JWT:', error);
                document.getElementById('capture-context-details').innerHTML = `
                    <div class="error">Error parsing JWT: ${error.message}</div>
                `;
            }
        }

        // Initialize the payment form
        function initializePaymentForm() {
            try {
                const payload = parseJwt(captureContext);
                
                // Extract clientLibrary and clientLibraryIntegrity
                const clientLibrary = payload.ctx[0].data.clientLibrary;
                const clientLibraryIntegrity = payload.ctx[0].data.clientLibraryIntegrity;
                
                if (!clientLibrary) {
                    throw new Error('Client library URL not found in capture context');
                }
                
                // Create script element with the extracted values
                const script = document.createElement('script');
                script.src = clientLibrary;
                if (clientLibraryIntegrity) {
                    script.integrity = clientLibraryIntegrity;
                }
                script.crossOrigin = 'anonymous';
                
                // Add the script to the document
                document.head.appendChild(script);
                
                // Set status to loading
                const statusElement = document.getElementById('status');
                statusElement.className = '';
                statusElement.textContent = 'Loading Unified Checkout SDK...';
                
                // Wait for script to load
                script.onload = function() {
                    console.log('Unified Checkout SDK loaded successfully');
                    
                    // Initialize Accept with the capture context
                    Accept(captureContext).then(function(accept) {
                        console.log('Accept initialized successfully');
                        
                        // Show success message
                        statusElement.className = 'success';
                        statusElement.textContent = 'Payment form initialized successfully!';
                        
                        // Display the accept object in the console
                        console.log('Accept object:', accept);
                        
                        // Show a message in the payment container
                        document.getElementById('payment-container').innerHTML = `
                            <div style="padding: 15px; border: 1px solid #ddd; border-radius: 4px; margin-top: 15px;">
                                <h3>Payment Form Initialized</h3>
                                <p>The Accept object has been initialized with the capture context.</p>
                                <p>In a production environment, you would use this object to process payments.</p>
                            </div>
                        `;
                    }).catch(function(error) {
                        console.error('Error initializing Accept:', error);
                        statusElement.className = 'error';
                        statusElement.textContent = 'Error initializing Accept: ' + (error.message || 'Unknown error');
                    });
                };
                
                script.onerror = function() {
                    console.error('Error loading Unified Checkout SDK');
                    statusElement.className = 'error';
                    statusElement.textContent = 'Error loading Unified Checkout SDK';
                };
            } catch (error) {
                console.error('Error:', error);
                const statusElement = document.getElementById('status');
                statusElement.className = 'error';
                statusElement.textContent = 'Error: ' + error.message;
            }
        }

        // Display capture context details when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            displayCaptureContextDetails();
            
            // Add event listener to initialize button
            document.getElementById('initialize-button').addEventListener('click', function() {
                initializePaymentForm();
            });
        });
    </script>
</body>
</html>